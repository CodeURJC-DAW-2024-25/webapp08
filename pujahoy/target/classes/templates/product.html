{{>header}}
<!-- BREADCRUMB -->
<div id="breadcrumb" class="section">
    <!-- container -->
    <div class="container">
        <!-- row -->
        <div class="row">
            <div class="col-md-12">
                <ul class="breadcrumb-tree">
                    <li><a href="#">Home</a></li>
                    <li><a href="#">Productos</a></li>
                    <li class="active">{{producto.nombre}}</li>
                </ul>
            </div>
        </div>
        <!-- /row -->
    </div>
    <!-- /container -->
</div>
<!-- /BREADCRUMB -->

<!-- SECTION -->
<div class="section">
    <!-- container -->
    <div class="container">
        <!-- row -->
        <div class="row">
            <!-- Product main img -->
            <div class="col-md-5 ">
                <div id="product-main-img">
                    <div class="product-preview">
                        {{#producto.imagen}}
                        <img src="{{producto.imagen}}" alt="Imagen del producto">
                        {{/producto.imagen}}
                        {{^producto.imagen}}
                        <img src="/img/default-product.png" alt="Imagen no disponible">
                        {{/producto.imagen}}
                    </div>

                </div>
            </div>
            <!-- /Product main img -->

            <!-- Product details -->
            <div class="col-md-5">
                <div class="product-details">
                    <h2 class="product-name">{{producto.nombre}}</h2>
                    <div>
                        <h3 class="product-price">Valor inicial: ${{producto.valorini}}</h3>
                    </div>
                    <p>Estado: {{producto.estado}}</p>
                    <p>{{producto.descripcion}}</p>
                    <div class="add-to-cart">
                        {{#usuario_autenticado}}
                        <form action="/product/{{producto.id}}/place-bid" method="post">
                            <button type="submit" class="add-to-cart-btn">
                                <i class="fa fa-shopping-cart"></i> Place bid
                            </button>
                        </form>
                        {{/usuario_autenticado}}
                    </div>
                    <div class="add-to-cart">
                        <button class="add-to-cart-btn"> Seller</button>
                    </div>
                    <div class="add-to-cart">
                        {{#admin}}
                        <form action="/product/{{producto.id}}/delete" method="post" style="display:inline;">
                            <button type="submit" class="add-to-cart-btn">Delete</button>
                        </form>
                        {{/admin}}
                    </div>
                </div>
            </div>
            <!-- /Product details -->

            <!-- Product tab -->
            <div class="col-md-12">
                <div id="product-tab">
                    <!-- product tab nav -->
                    <ul class="tab-nav">
                        <li class="active"><a data-toggle="tab" href="#tab1">Description</a></li>
                        <li><a data-toggle="tab" href="#tab3">Reviews (3)</a></li>
                    </ul>
                    <!-- /product tab nav -->

                    <!-- product tab content -->
                    <div class="tab-content">
                        <!-- tab1  -->
                        <div id="tab1" class="tab-pane fade in active">
                            <div class="row">
                                <div class="col-md-12">
                                    <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor
                                        incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis
                                        nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.
                                        Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu
                                        fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in
                                        culpa qui officia deserunt mollit anim id est laborum.</p>
                                </div>
                            </div>
                        </div>
                        <!-- /tab1  -->

                        <!-- tab3  -->
                        <!-- Reviews (buyers' version) -->
                        <div id="tab3" class="tab-pane fade in">
                            <div class="row">
                                <!-- SecciÃ³n de Rating General -->
                                <div class="col-md-3">
                                    <div id="rating">
                                        <div class="rating-avg">
                                            <span>4.5</span>
                                            <div class="rating-stars">
                                                <i class="fa fa-star"></i>
                                                <i class="fa fa-star"></i>
                                                <i class="fa fa-star"></i>
                                                <i class="fa fa-star"></i>
                                                <i class="fa fa-star-o"></i>
                                            </div>
                                        </div>
                                        <ul class="rating">
                                            <li>
                                                <div class="rating-stars">
                                                    <i class="fa fa-star"></i>
                                                    <i class="fa fa-star"></i>
                                                    <i class="fa fa-star"></i>
                                                    <i class="fa fa-star"></i>
                                                    <i class="fa fa-star"></i>
                                                </div>
                                                <div class="rating-progress">
                                                    <div style="width: 80%;"></div>
                                                </div>
                                                <span class="sum">3</span>
                                            </li>
                                            <li>
                                                <div class="rating-stars">
                                                    <i class="fa fa-star"></i>
                                                    <i class="fa fa-star"></i>
                                                    <i class="fa fa-star"></i>
                                                    <i class="fa fa-star"></i>
                                                    <i class="fa fa-star-o"></i>
                                                </div>
                                                <div class="rating-progress">
                                                    <div style="width: 60%;"></div>
                                                </div>
                                                <span class="sum">2</span>
                                            </li>
                                            <li>
                                                <div class="rating-stars">
                                                    <i class="fa fa-star"></i>
                                                    <i class="fa fa-star"></i>
                                                    <i class="fa fa-star"></i>
                                                    <i class="fa fa-star-o"></i>
                                                    <i class="fa fa-star-o"></i>
                                                </div>
                                                <div class="rating-progress">
                                                    <div></div>
                                                </div>
                                                <span class="sum">0</span>
                                            </li>
                                            <li>
                                                <div class="rating-stars">
                                                    <i class="fa fa-star"></i>
                                                    <i class="fa fa-star"></i>
                                                    <i class="fa fa-star-o"></i>
                                                    <i class="fa fa-star-o"></i>
                                                    <i class="fa fa-star-o"></i>
                                                </div>
                                                <div class="rating-progress">
                                                    <div></div>
                                                </div>
                                                <span class="sum">0</span>
                                            </li>
                                            <li>
                                                <div class="rating-stars">
                                                    <i class="fa fa-star"></i>
                                                    <i class="fa fa-star-o"></i>
                                                    <i class="fa fa-star-o"></i>
                                                    <i class="fa fa-star-o"></i>
                                                    <i class="fa fa-star-o"></i>
                                                </div>
                                                <div class="rating-progress">
                                                    <div></div>
                                                </div>
                                                <span class="sum">0</span>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                                <!-- /SecciÃ³n de Rating General -->

                                <!-- Listado de Reviews -->
                                <div class="col-md-6">
                                    <div id="reviews">
                                        <ul class="reviews">
                                            <li>
                                                <div class="review-heading">
                                                    <h5 class="name">John Doe</h5>
                                                    <p class="date">27 DEC 2018, 8:00 PM</p>
                                                    <div class="review-rating">
                                                        <i class="fa fa-star"></i>
                                                        <i class="fa fa-star"></i>
                                                        <i class="fa fa-star"></i>
                                                        <i class="fa fa-star"></i>
                                                        <i class="fa fa-star-o empty"></i>
                                                    </div>
                                                </div>
                                                <div class="review-body">
                                                    <p>
                                                        Producto excelente, muy recomendable. La transacciÃ³n fue segura
                                                        y el vendedor respondiÃ³ rÃ¡pidamente.
                                                    </p>
                                                </div>
                                            </li>
                                            <li>
                                                <div class="review-heading">
                                                    <h5 class="name">Jane Smith</h5>
                                                    <p class="date">15 NOV 2018, 6:30 PM</p>
                                                    <div class="review-rating">
                                                        <i class="fa fa-star"></i>
                                                        <i class="fa fa-star"></i>
                                                        <i class="fa fa-star"></i>
                                                        <i class="fa fa-star"></i>
                                                        <i class="fa fa-star-o empty"></i>
                                                    </div>
                                                </div>
                                                <div class="review-body">
                                                    <p>
                                                        Muy buena atenciÃ³n, la entrega fue puntual y el proceso de
                                                        subasta transparente.
                                                    </p>
                                                </div>
                                            </li>
                                            <!-- Se pueden agregar mÃ¡s reseÃ±as de otros compradores -->
                                        </ul>
                                        <ul class="reviews-pagination">
                                            <li class="active">1</li>
                                            <li><a href="#">2</a></li>
                                            <li><a href="#">3</a></li>
                                            <li><a href="#">4</a></li>
                                            <li><a href="#"><i class="fa fa-angle-right"></i></a></li>
                                        </ul>
                                    </div>
                                </div>
                                <!-- /Listado de Reviews -->

                                <!-- Formulario para dejar Review (habilitado) -->
                                <div class="col-md-3">
                                    <div id="review-form">
                                        <form class="review-form" action="submit_review.html" method="post">
                                            <!-- Campos ocultos para asociar la review con el producto y el vendedor -->
                                            <input type="hidden" name="product_id" value="123">
                                            <input type="hidden" name="seller_id" value="456">

                                            <input class="input" type="text" name="user_name" placeholder="Your Name">
                                            <input class="input" type="email" name="user_email"
                                                placeholder="Your Email">
                                            <textarea class="input" name="review_text"
                                                placeholder="Your Review"></textarea>
                                            <div class="input-rating">
                                                <span>Your Rating: </span>
                                                <div class="stars">
                                                    <input id="star5" name="rating" value="5" type="radio"><label
                                                        for="star5"></label>
                                                    <input id="star4" name="rating" value="4" type="radio"><label
                                                        for="star4"></label>
                                                    <input id="star3" name="rating" value="3" type="radio"><label
                                                        for="star3"></label>
                                                    <input id="star2" name="rating" value="2" type="radio"><label
                                                        for="star2"></label>
                                                    <input id="star1" name="rating" value="1" type="radio"><label
                                                        for="star1"></label>
                                                </div>
                                            </div>
                                            <button class="primary-btn" type="submit">Submit</button>
                                        </form>
                                    </div>
                                </div>
                                <!-- /Formulario para dejar Review -->
                            </div>
                        </div>
                        <!-- /tab3  -->
                    </div>
                    <!-- /product tab content  -->
                </div>
            </div>
            <!-- /product tab -->
        </div>
        <!-- /row -->
    </div>
    <!-- /container -->
</div>
<!-- /SECTION -->
<!-- MAP SECTION -->
<div class="section">
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <h3>UbicaciÃ³n del Producto</h3>
                <div id="map" style="height: 400px;"></div>
            </div>
        </div>
    </div>
</div>
<!-- /MAP SECTION -->
{{>footer}}

<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        var map = L.map('map').setView([0, 0], 2); // Mapa inicial vacÃ­o

        // Agregar capa de OpenStreetMap
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; OpenStreetMap contributors'
        }).addTo(map);

        var marker;

        function mostrarUbicacion(codigoPostal) {
            if (!codigoPostal) {
                alert("No hay cÃ³digo postal disponible.");
                return;
            }

            var url = `https://nominatim.openstreetmap.org/search?format=json&q=${codigoPostal}`;

            fetch(url)
                .then(response => response.json())
                .then(data => {
                    if (data.length === 0) {
                        alert("UbicaciÃ³n no encontrada para el cÃ³digo postal.");
                        return;
                    }

                    var { lat, lon, display_name } = data[0];
                    map.setView([lat, lon], 12);

                    if (marker) map.removeLayer(marker);
                    marker = L.marker([lat, lon]).addTo(map)
                        .bindPopup(display_name)
                        .openPopup();
                })
                .catch(error => console.error("Error obteniendo ubicaciÃ³n:", error));
        }

        // Llamar a la funciÃ³n con el cÃ³digo postal del producto
        mostrarUbicacion("{{codigoPostal}}");
    });
</script>