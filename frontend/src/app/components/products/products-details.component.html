<!-- BREADCRUMB -->
<div class="section py-2 bg-light border-bottom">
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <nav class="breadcrumb-custom">
                    <a routerLink="/" class="breadcrumb-link">HOME</a>
                    <span class="breadcrumb-separator">/</span>
                    <span class="breadcrumb-current">{{ product?.name?.toUpperCase() }}</span>
                </nav>
            </div>
        </div>
    </div>
</div>

<!-- PRODUCT SECTION -->
<div class="section py-5">
    <div class="container">
        <div class="row">
            <!-- Product Image -->
            <div class="col-md-5">
                <div class="product-preview border p-3">
                    <img [src]="product?.imgURL ? '/api/v1' + product?.imgURL : '/img/default-product.png'"
                        class="img-fluid" alt="Product image" />
                </div>
            </div>

            <!-- Product Details -->
            <div class="col-md-5">
                <div class="product-details">
                    <h2 class="product-name">{{ product?.name }}</h2>
                    <h4 class="product-price text-danger mb-3">Initial Price: €{{ product?.iniValue }}</h4>
                    <p class="mb-2"><strong>Status:</strong> {{ product?.state }}</p>
                    <p>{{ product?.description }}</p>

                    <!-- Place Bid Input -->
                    <div class="mb-3" *ngIf="canPlaceABid">
                        <input type="number" class="form-control form-control-sm mb-2" placeholder="Place your bid"
                            [(ngModel)]="bidAmount">
                        <button class="btn btn-sm btn-primary" (click)="placeBid()">Place Bid</button>
                    </div>


                    <!-- Actions -->
                    <div class="my-3">
                        <button routerLink="/users/{{ product?.seller?.id }}"
                            class="btn btn-sm btn-outline-secondary me-2">Seller</button>
                        <button *ngIf="canDelete" (click)="deleteProduct()" class="btn btn-sm btn-outline-danger me-2">Delete</button>
                        <div *ngIf="canRate">
                            <button *ngIf="!ratedProduct" (click)="ratedProduct = !ratedProduct"
                                class="btn btn-sm btn-outline-success me-2">
                                Rating
                            </button>
                        </div>
                        <div *ngIf="canCheckOut">
                            <button *ngIf="checkoutProduct" (click)="checkout()"
                                class="btn btn-sm btn-outline-info me-2">
                                Checkout
                            </button>
                        </div>
                        <button *ngIf="canEdit" routerLink="/product/{{ product?.id }}/edit"
                            class="btn btn-sm btn-outline-danger me-2">Edit</button>
                    </div>
                </div>
            </div>



            <!-- Auction Info -->
            <div class="col-md-2 text-end">
                <div class="info-box mb-3">
                    <small class="text-muted"><strong>End Date:</strong></small>
                    <div class="fw-bold">{{ product?.endHour }}</div>
                </div>
                <div class="info-box mb-3">
                    <small class="text-muted"><strong>Winning Bid:</strong></small>
                    <div class="fw-bold text-success">€{{ higherOffer?.cost || 'N/A' }}</div>
                </div>
                <div class="info-box">
                    <small class="text-muted"><strong>Bidder:</strong></small>
                    <div class="fw-bold">{{ higherOffer?.user?.name || 'N/A' }}</div>
                </div>
            </div>

            <div *ngIf="ratedProduct" class="d-flex justify-content-center" style="padding-top: 15px;">
                <div class="p-3 border rounded bg-light w-20">
                    <h5 class="mb-3">Rate this product</h5>
                    <div class="mb-3">
                        <input type="number" [(ngModel)]="rating" min="1" max="5" required
                            class="form-control w-50 d-inline-block text-center" placeholder="1-5">
                    </div>
                    <button class="btn btn-sm btn-outline-success me-2" (click)="submitRating()">Submit</button>
                    <button (click)="ratedProduct = !ratedProduct" class="btn btn-sm btn-outline-danger">Cancel</button>
                </div>
            </div>

            <h3 style="margin-top: 50px;">Product Location</h3>
            <div class="map-wrapper">
                <iframe *ngIf="safeMapUrl" [src]="safeMapUrl" width="100%" height="400"
                    style="border:0; border-radius: 5px;" loading="lazy" referrerpolicy="no-referrer-when-downgrade">
                </iframe>
            </div>
            <br><br>
            <div id="bid-history">
                <h3>Bidding History</h3>
                <canvas #bidsChart></canvas>
            </div>
        </div>
    </div>
</div>